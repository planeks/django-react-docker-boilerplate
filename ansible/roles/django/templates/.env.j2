# Environment configuration for {{ deploy_env }} environment
# Generated by Ansible on {{ ansible_date_time.iso8601 }}
# Server: {{ ansible_hostname }}

PYTHONENCODING=utf8
COMPOSE_IMAGES_PREFIX={{ project_name }}
DEBUG={{ '0' if deploy_env == 'production' else '1' }}
CONFIGURATION={{ 'prod' if deploy_env == 'production' else 'dev' }}
DJANGO_LOG_LEVEL={{ django_log_level | default('INFO') }}

# Security
{% if secret_key is defined %}
SECRET_KEY="{{ secret_key }}"
{% else %}
# WARNING: Generate a secure secret key before deploying!
# Generate with: python -c 'from django.core.management.utils import get_random_secret_key; print(get_random_secret_key())'
SECRET_KEY="<CHANGE-ME-INSECURE-KEY>"
{% endif %}

# Domain Configuration
{% if deploy_env == 'production' %}
ALLOWED_HOSTS={{ domain_name | default('example.com') }}
SITE_DOMAIN={{ domain_name | default('example.com') }}
SITE_URL=https://{{ domain_name | default('example.com') }}
{% else %}
ALLOWED_HOSTS={{ domain_name | default('localhost,127.0.0.1') }}
SITE_DOMAIN={{ domain_name | default(project_name + '.local') }}
SITE_URL=http://{{ domain_name | default(project_name + '.local:8000') }}
{% endif %}

# Database Configuration
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
POSTGRES_DB={{ db_name | default('db') }}
POSTGRES_USER={{ db_user | default('dbuser') }}
POSTGRES_PASSWORD={{ db_password | default('changeme') }}

# Redis Configuration
REDIS_URL=redis://redis:6379/0

# Email Configuration
{% if deploy_env != 'production' %}
EMAIL_HOST=mailhog
EMAIL_PORT=1025
EMAIL_HOST_USER=
EMAIL_HOST_PASSWORD=
{% else %}
EMAIL_HOST={{ email_host | default('') }}
EMAIL_PORT={{ email_port | default('25') }}
EMAIL_HOST_USER={{ email_user | default('') }}
EMAIL_HOST_PASSWORD={{ email_password | default('') }}
{% endif %}

# Monitoring (Optional)
SENTRY_DSN={{ sentry_dsn | default('') }}

# Celery Flower (Task Monitor)
CELERY_FLOWER_USER={{ celery_flower_user | default('flower') }}
CELERY_FLOWER_PASSWORD={{ celery_flower_password | default('changeme') }}

{% if deploy_env == 'production' %}
# Caddy Web Server
# Generate hash with: caddy hash-password --plaintext 'your_password'
CADDY_PASSWORD={{ caddy_password | default('') }}
{% endif %}

# Frontend Configuration
VITE_DEV_SERVER_HOST={% if deploy_env == 'production' %}{{ vite_dev_server_host | default('localhost') }}{% else %}localhost{% endif %}

# Django Settings
DJANGO_SETTINGS_MODULE=config.settings.{{ 'prod' if deploy_env == 'production' else 'dev' }}
COMPOSE_PROJECT_NAME={{ project_name }}
